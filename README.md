# Discord OpenWebUI Bot

A Discord bot written in Python using `discord.py` that interacts with users randomly based on messages in a specific channel and welcomes new members, using an Open WebUI instance for generating responses.

## Features

*   **Random Interaction:** Monitors a configured channel (`TARGET_CHANNEL_ID`) and randomly decides whether to respond to a message.
*   **LLM Integration:** Uses an Open WebUI compatible API (like the one provided by LM Studio, Ollama with OpenAI endpoint, or Open WebUI itself) to generate context-aware responses based on user messages.
*   **Context Management:** Maintains separate conversation histories for each user interacting with the bot to provide more relevant replies.
*   **Welcome Messages:** Greets new members joining the server in a configured channel (`WELCOME_CHANNEL_ID`) with a custom message generated by the LLM.
*   **Configurable:** Bot token, channel IDs, reply randomness, and Open WebUI details are configured via an `.env` file.
*   **Modular Design:** Bot events are handled in a separate Cog (`cogs/events.py`), and API interaction is in its own module (`utils/webui_api.py`).
*   **Dockerized:** Includes a `Dockerfile` for easy containerization and deployment.

## Prerequisites

*   **Python:** Version 3.8 or higher.
*   **Discord Bot Token:** Obtainable from the [Discord Developer Portal](https://discord.com/developers/applications).
    *   **Required Intents:** Ensure your bot has the `Server Members Intent` and `Message Content Intent` enabled in the Developer Portal under the "Bot" section.
*   **Open WebUI Instance:** A running instance accessible via HTTP (e.g., running locally, on a server, via Ollama's OpenAI compatible endpoint, LM Studio, etc.). You'll need its URL and the name of the model you want to use.
*   **Channel IDs:** You need the IDs for the channels the bot will monitor, respond in, and send welcome messages to. Enable Developer Mode in Discord (User Settings > Advanced) and right-click channels to copy their IDs.
*   **Docker (Optional):** Required if you want to run the bot using the provided `Dockerfile`.

## Configuration

1.  **Create `.env` file:** Create a file named `.env` in the project's root directory.
2.  **Populate `.env`:** Copy the contents from the example below and replace the placeholder values with your actual configuration:

    ```dotenv
    # Discord Bot Configuration
    DISCORD_TOKEN=YOUR_BOT_TOKEN_HERE

    # Channel IDs (Get these from Discord by enabling Developer Mode)
    TARGET_CHANNEL_ID=YOUR_TARGET_CHANNEL_ID_HERE  # Channel to monitor for messages
    RESPONSE_CHANNEL_ID=YOUR_RESPONSE_CHANNEL_ID_HERE # Channel where the bot sends replies
    WELCOME_CHANNEL_ID=YOUR_WELCOME_CHANNEL_ID_HERE  # Channel for welcome messages

    # Bot Behavior
    # Chance for the bot to reply (e.g., 0.05 for 5%, 0.1 for 10%)
    RANDOM_REPLY_CHANCE=0.05

    # Open WebUI Configuration
    OPENWEBUI_API_URL=http://YOUR_OPENWEBUI_INSTANCE_IP:PORT # e.g., http://127.0.0.1:8080
    OPENWEBUI_MODEL=YOUR_MODEL_NAME_HERE # e.g., llama3:latest, mistral:latest
    # Optional: Add API Key if your OpenWebUI instance requires it
    # OPENWEBUI_API_KEY=YOUR_OPTIONAL_API_KEY
    ```

## Installation & Running

### Method 1: Running Directly with Python

1.  **Clone the repository (or create the files):** Ensure you have all the files (`bot.py`, `requirements.txt`, `.env`, `Dockerfile`, `README.md`, `utils/webui_api.py`, `cogs/events.py`) in your project folder.
2.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```
3.  **Configure `.env`:** Make sure your `.env` file is correctly filled out (see Configuration section).
4.  **Run the bot:**
    ```bash
    python bot.py
    ```

### Method 2: Running with Docker

1.  **Ensure Docker is installed and running.**
2.  **Configure `.env`:** Make sure your `.env` file is correctly filled out in the project directory.
3.  **Build the Docker image:** Open a terminal in the project's root directory and run:
    ```bash
    docker build -t my-discord-webui-bot .
    ```
    (You can replace `my-discord-webui-bot` with your desired image name).
4.  **Run the Docker container:** You need to make the `.env` file accessible to the container. Choose one of the following methods:

    *   **Using `--env-file` (Recommended):**
        ```bash
        docker run --env-file .env --rm --name discord-bot-container my-discord-webui-bot
        ```
    *   **Using volume mount (Alternative):**
        ```bash
        # Replace $(pwd) with %cd% on Windows Command Prompt
        docker run -v "$(pwd)/.env:/app/.env" --rm --name discord-bot-container my-discord-webui-bot
        ```

    *   `--rm`: Automatically removes the container when it stops.
    *   `--name`: Assigns a name to the running container.

## Project Structure